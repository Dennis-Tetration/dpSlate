!function(e){e.isScrollToFixed=function(t){return!!e(t).data("ScrollToFixed")},e.ScrollToFixed=function(t,i){function o(){F.trigger("preUnfixed.ScrollToFixed"),u(),F.trigger("unfixed.ScrollToFixed"),E=-1,T=F.offset().top,k=F.offset().left,m.options.offsets&&(k+=F.offset().left-F.position().left),-1==$&&($=k),v=F.css("position"),b=!0,-1!=m.options.bottom&&(F.trigger("preFixed.ScrollToFixed"),a(),F.trigger("fixed.ScrollToFixed"))}function n(){var e=m.options.limit;return e?"function"==typeof e?e.apply(F):e:0}function r(){return"fixed"===v}function s(){return"absolute"===v}function l(){return!(r()||s())}function a(){if(!r()){var e=F[0].getBoundingClientRect();N.css({display:F.css("display"),width:e.width,height:e.height,"float":F.css("float")}),cssOptions={"z-index":m.options.zIndex,position:"fixed",top:-1==m.options.bottom?h():"",bottom:-1==m.options.bottom?"":m.options.bottom,"margin-left":"0px"},m.options.dontSetWidth||(cssOptions.width=F.css("width")),F.css(cssOptions),F.addClass(m.options.baseClassName),m.options.className&&F.addClass(m.options.className),v="fixed"}}function c(){var e=n(),t=k;m.options.removeOffsets&&(t="",e-=T),cssOptions={position:"absolute",top:e,left:t,"margin-left":"0px",bottom:""},m.options.dontSetWidth||(cssOptions.width=F.css("width")),F.css(cssOptions),v="absolute"}function u(){l()||(E=-1,N.css("display","none"),F.css({"z-index":w,width:"",position:x,left:"",top:y,"margin-left":""}),F.removeClass("scroll-to-fixed-fixed"),m.options.className&&F.removeClass(m.options.className),v=null)}function d(e){e!=E&&(F.css("left",k-e),E=e)}function h(){var e=m.options.marginTop;return e?"function"==typeof e?e.apply(F):e:0}function p(){if(e.isScrollToFixed(F)&&!F.is(":hidden")){var t=b,i=l();b?l()&&(T=F.offset().top,k=F.offset().left):o();var p=e(window).scrollLeft(),v=e(window).scrollTop(),S=n();m.options.minWidth&&e(window).width()<m.options.minWidth?l()&&t||(g(),F.trigger("preUnfixed.ScrollToFixed"),u(),F.trigger("unfixed.ScrollToFixed")):m.options.maxWidth&&e(window).width()>m.options.maxWidth?l()&&t||(g(),F.trigger("preUnfixed.ScrollToFixed"),u(),F.trigger("unfixed.ScrollToFixed")):-1==m.options.bottom?S>0&&v>=S-h()?i||s()&&t||(g(),F.trigger("preAbsolute.ScrollToFixed"),c(),F.trigger("unfixed.ScrollToFixed")):v>=T-h()?(r()&&t||(g(),F.trigger("preFixed.ScrollToFixed"),a(),E=-1,F.trigger("fixed.ScrollToFixed")),d(p)):l()&&t||(g(),F.trigger("preUnfixed.ScrollToFixed"),u(),F.trigger("unfixed.ScrollToFixed")):S>0?v+e(window).height()-F.outerHeight(!0)>=S-(h()||-f())?r()&&(g(),F.trigger("preUnfixed.ScrollToFixed"),"absolute"===x?c():u(),F.trigger("unfixed.ScrollToFixed")):(r()||(g(),F.trigger("preFixed.ScrollToFixed"),a()),d(p),F.trigger("fixed.ScrollToFixed")):d(p)}}function f(){return m.options.bottom?m.options.bottom:0}function g(){var e=F.css("position");"absolute"==e?F.trigger("postAbsolute.ScrollToFixed"):"fixed"==e?F.trigger("postFixed.ScrollToFixed"):F.trigger("postUnfixed.ScrollToFixed")}var m=this;m.$el=e(t),m.el=t,m.$el.data("ScrollToFixed",m);var v,x,S,y,w,b=!1,F=m.$el,T=0,k=0,$=-1,E=-1,N=null,C=function(e){F.is(":visible")?(b=!1,p()):u()},O=function(e){window.requestAnimationFrame?requestAnimationFrame(p):p()},_=function(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.returnValue=!1};m.init=function(){m.options=e.extend({},e.ScrollToFixed.defaultOptions,i),w=F.css("z-index"),m.$el.css("z-index",m.options.zIndex),N=e("<div />"),v=F.css("position"),x=F.css("position"),S=F.css("float"),y=F.css("top"),l()&&m.$el.after(N),e(window).bind("resize.ScrollToFixed",C),e(window).bind("scroll.ScrollToFixed",O),"ontouchmove"in window&&e(window).bind("touchmove.ScrollToFixed",p),m.options.preFixed&&F.bind("preFixed.ScrollToFixed",m.options.preFixed),m.options.postFixed&&F.bind("postFixed.ScrollToFixed",m.options.postFixed),m.options.preUnfixed&&F.bind("preUnfixed.ScrollToFixed",m.options.preUnfixed),m.options.postUnfixed&&F.bind("postUnfixed.ScrollToFixed",m.options.postUnfixed),m.options.preAbsolute&&F.bind("preAbsolute.ScrollToFixed",m.options.preAbsolute),m.options.postAbsolute&&F.bind("postAbsolute.ScrollToFixed",m.options.postAbsolute),m.options.fixed&&F.bind("fixed.ScrollToFixed",m.options.fixed),m.options.unfixed&&F.bind("unfixed.ScrollToFixed",m.options.unfixed),m.options.spacerClass&&N.addClass(m.options.spacerClass),F.bind("resize.ScrollToFixed",function(){N.height(F.height())}),F.bind("scroll.ScrollToFixed",function(){F.trigger("preUnfixed.ScrollToFixed"),u(),F.trigger("unfixed.ScrollToFixed"),p()}),F.bind("detach.ScrollToFixed",function(t){_(t),F.trigger("preUnfixed.ScrollToFixed"),u(),F.trigger("unfixed.ScrollToFixed"),e(window).unbind("resize.ScrollToFixed",C),e(window).unbind("scroll.ScrollToFixed",O),F.unbind(".ScrollToFixed"),N.remove(),m.$el.removeData("ScrollToFixed")}),C()},m.init()},e.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3,baseClassName:"scroll-to-fixed-fixed"},e.fn.scrollToFixed=function(t){return this.each(function(){new e.ScrollToFixed(this,t)})}}(jQuery);
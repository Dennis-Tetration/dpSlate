!function(o){o.isScrollToFixed=function(i){return!!o(i).data("ScrollToFixed")},o.ScrollToFixed=function(i,e){function t(){v.trigger("preUnfixed.ScrollToFixed"),a(),v.trigger("unfixed.ScrollToFixed"),y=-1,A=v.offset().top,U=v.offset().left,h.options.offsets&&(U+=v.offset().left-v.position().left),-1==z&&(z=U),F=v.css("position"),w=!0,-1!=h.options.bottom&&(v.trigger("preFixed.ScrollToFixed"),l(),v.trigger("fixed.ScrollToFixed"))}function n(){var o=h.options.limit;return o?"function"==typeof o?o.apply(v):o:0}function s(){return"fixed"===F}function r(){return"absolute"===F}function d(){return!(s()||r())}function l(){if(!s()){var o=v[0].getBoundingClientRect();C.css({display:v.css("display"),width:o.width,height:o.height,"float":v.css("float")}),cssOptions={"z-index":h.options.zIndex,position:"fixed",top:-1==h.options.bottom?p():"",bottom:-1==h.options.bottom?"":h.options.bottom,"margin-left":"0px"},h.options.dontSetWidth||(cssOptions.width=v.css("width")),v.css(cssOptions),v.addClass(h.options.baseClassName),h.options.className&&v.addClass(h.options.className),F="fixed"}}function c(){var o=n(),i=U;h.options.removeOffsets&&(i="",o-=A),cssOptions={position:"absolute",top:o,left:i,"margin-left":"0px",bottom:""},h.options.dontSetWidth||(cssOptions.width=v.css("width")),v.css(cssOptions),F="absolute"}function a(){d()||(y=-1,C.css("display","none"),v.css({"z-index":b,width:"",position:T,left:"",top:S,"margin-left":""}),v.removeClass("scroll-to-fixed-fixed"),h.options.className&&v.removeClass(h.options.className),F=null)}function f(o){o!=y&&(v.css("left",U-o),y=o)}function p(){var o=h.options.marginTop;return o?"function"==typeof o?o.apply(v):o:0}function u(){if(o.isScrollToFixed(v)&&!v.is(":hidden")){var i=w,e=d();w?d()&&(A=v.offset().top,U=v.offset().left):t();var u=o(window).scrollLeft(),F=o(window).scrollTop(),m=n();h.options.minWidth&&o(window).width()<h.options.minWidth?d()&&i||(g(),v.trigger("preUnfixed.ScrollToFixed"),a(),v.trigger("unfixed.ScrollToFixed")):h.options.maxWidth&&o(window).width()>h.options.maxWidth?d()&&i||(g(),v.trigger("preUnfixed.ScrollToFixed"),a(),v.trigger("unfixed.ScrollToFixed")):-1==h.options.bottom?m>0&&F>=m-p()?e||r()&&i||(g(),v.trigger("preAbsolute.ScrollToFixed"),c(),v.trigger("unfixed.ScrollToFixed")):F>=A-p()?(s()&&i||(g(),v.trigger("preFixed.ScrollToFixed"),l(),y=-1,v.trigger("fixed.ScrollToFixed")),f(u)):d()&&i||(g(),v.trigger("preUnfixed.ScrollToFixed"),a(),v.trigger("unfixed.ScrollToFixed")):m>0?F+o(window).height()-v.outerHeight(!0)>=m-(p()||-x())?s()&&(g(),v.trigger("preUnfixed.ScrollToFixed"),"absolute"===T?c():a(),v.trigger("unfixed.ScrollToFixed")):(s()||(g(),v.trigger("preFixed.ScrollToFixed"),l()),f(u),v.trigger("fixed.ScrollToFixed")):f(u)}}function x(){return h.options.bottom?h.options.bottom:0}function g(){var o=v.css("position");"absolute"==o?v.trigger("postAbsolute.ScrollToFixed"):"fixed"==o?v.trigger("postFixed.ScrollToFixed"):v.trigger("postUnfixed.ScrollToFixed")}var h=this;h.$el=o(i),h.el=i,h.$el.data("ScrollToFixed",h);var F,T,m,S,b,w=!1,v=h.$el,A=0,U=0,z=-1,y=-1,C=null,X=function(o){v.is(":visible")?(w=!1,u()):a()},Y=function(o){window.requestAnimationFrame?requestAnimationFrame(u):u()},N=function(o){o=o||window.event,o.preventDefault&&o.preventDefault(),o.returnValue=!1};h.init=function(){h.options=o.extend({},o.ScrollToFixed.defaultOptions,e),b=v.css("z-index"),h.$el.css("z-index",h.options.zIndex),C=o("<div />"),F=v.css("position"),T=v.css("position"),m=v.css("float"),S=v.css("top"),d()&&h.$el.after(C),o(window).bind("resize.ScrollToFixed",X),o(window).bind("scroll.ScrollToFixed",Y),"ontouchmove"in window&&o(window).bind("touchmove.ScrollToFixed",u),h.options.preFixed&&v.bind("preFixed.ScrollToFixed",h.options.preFixed),h.options.postFixed&&v.bind("postFixed.ScrollToFixed",h.options.postFixed),h.options.preUnfixed&&v.bind("preUnfixed.ScrollToFixed",h.options.preUnfixed),h.options.postUnfixed&&v.bind("postUnfixed.ScrollToFixed",h.options.postUnfixed),h.options.preAbsolute&&v.bind("preAbsolute.ScrollToFixed",h.options.preAbsolute),h.options.postAbsolute&&v.bind("postAbsolute.ScrollToFixed",h.options.postAbsolute),h.options.fixed&&v.bind("fixed.ScrollToFixed",h.options.fixed),h.options.unfixed&&v.bind("unfixed.ScrollToFixed",h.options.unfixed),h.options.spacerClass&&C.addClass(h.options.spacerClass),v.bind("resize.ScrollToFixed",function(){C.height(v.height())}),v.bind("scroll.ScrollToFixed",function(){v.trigger("preUnfixed.ScrollToFixed"),a(),v.trigger("unfixed.ScrollToFixed"),u()}),v.bind("detach.ScrollToFixed",function(i){N(i),v.trigger("preUnfixed.ScrollToFixed"),a(),v.trigger("unfixed.ScrollToFixed"),o(window).unbind("resize.ScrollToFixed",X),o(window).unbind("scroll.ScrollToFixed",Y),v.unbind(".ScrollToFixed"),C.remove(),h.$el.removeData("ScrollToFixed")}),X()},h.init()},o.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3,baseClassName:"scroll-to-fixed-fixed"},o.fn.scrollToFixed=function(i){return this.each(function(){new o.ScrollToFixed(this,i)})}}(jQuery);
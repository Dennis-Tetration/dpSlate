<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Authoring a DevNet API Reference Manual</title>


    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["shell"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">Sample</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li>V1.0.0</li>
            <li>Copyright &copy; 2014 by Cisco Systems, Inc.</li>
            <li>All Rights Reserved.</li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='authoring-a-devnet-api-reference-manual'>Authoring a DevNet API Reference Manual</h1>
<p>DevNet is Cisco&rsquo;s Developer Program aimed a helping developers gain access to Cisco Technology such that they can build cool and exciting products.  Wether a developer is an IT Professional working inside of a Cisco Customer&rsquo;s IT organization, a System Integrator, or a developer at an Independent Software Developer Program, Cisco DevNet is there to help make your professional life easier.</p>

<p>Cisco has hundreds of product API&rsquo;s for developers.  We want to make it easy for you to find the API that you need to get your job done but we also want to make it easy
for you to use the API of choice.  To do this, we are providing a standard format for the documentation of API&rsquo;s with Cisco.</p>

<p>This document describes how an engineer or tech writer within Cisco would write an API reference manual for publication on DevNet.  The toolchain that we are using is based upon Slate, the open source tool from TripIt, which in turn was inspired by the API Reference Manual published by Stripe.  Like many developers, we love the simple, elegant, yet powerful way that Stripe documented their API.  In particular we loved how within the context of any given API call, you can choose a language and see sample code - we knew that we were not alone and thus we chose to model our own documentation on this style.</p>

<p>Overtime, we have ideas on how we can update and modify this format to better suit the needs of the developer community and we are already planning those changes.  But for now, we have this initial version.</p>
<h1 id='getting-started-with-devnet-slate'>Getting Started with DevNet Slate</h1><h2 id='installing-the-prerequisites'>Installing the Prerequisites</h2>
<blockquote>
<p>What Version of Ruby is Installed?</p>
</blockquote>
<pre class="highlight markdown">$ ruby -v

ruby 2.0.0p247 (2013-06-27 revision 41674)

</pre>

<blockquote>
<p>How to install Bundler (Shell Tab)</p>
</blockquote>
<pre class="highlight markdown">$ gem install bundler
</pre>

<p>DevNet Slate can be installed on any system because of Ruby&rsquo;s portability.</p>

<ol>
<li>Make sure that Ruby is installed.</li>
<li>Make sure that Bundler is installed.</li>
</ol>

<p>If you do not have Ruby installed, go to https://www.ruby-lang.org/ and get it.</p>

<p><aside class="warning">
Ruby Version 1.9.3 or newer is required for Slate, if you have Ruby installed, make sure that it is at least that version.
</aside></p>
<h2 id='setup-options'>Setup Options</h2>
<p>There are two ways that you can setup DevNet Slate for creating documents on your local PC; Forking/cloning from DevNet Slate Github or downloading the DevNet Slate Zip file from Github.  Each has pros and cons:</p>
<h3 id='fork-and-clone'>Fork and Clone</h3>
<p>When you Fork DevNet Slate on Github, Github remembers the relationship between your version of DevNet Slate and the master version.  Thus, when changes are made to DevNet Slate in the master tree, you will be able to pull these changes and include the latest fixes and changes into your personal copy of DevNet Slate.  Additionally, when you <strong>publish</strong> your document, the document will be placed into Github.</p>

<p><aside class="notice">
DevNet Slate supports either building or publishing.  When you build the document, only your local files are updated.  When you publish, the files on Github are also updated.
</aside></p>
<h3 id='installing-the-zip'>Installing the Zip</h3>
<p>When you download the Zip file and install DevNet Slate, like the Fork and Clone, it will create a local directory, but you are not notified of changes.  Also, when you build your HTML document, you will not be able to publish it to Github if that is what you desire.</p>
<h2 id='getting-set-up'>Getting Set Up</h2>
<blockquote>
<p>Clone the Forked Repository</p>
</blockquote>
<pre class="highlight markdown">$ git clone https://github.com/YOURUSERNAME/DevNetSlate.git
</pre>

<blockquote>
<p>Install the Dependencies</p>
</blockquote>
<pre class="highlight markdown">$ cd DevNetSlate
$ bundle install
</pre>

<blockquote>
<p>Start Your Test Server</p>
</blockquote>
<pre class="highlight markdown">$ bundle exec middleman server
== The Middleman is loading
== The Middleman is standing watch at http://0.0.0.0:4567
== Inspect your site configuration at http://0.0.0.0:4567/__middleman/

</pre>

<ol>
<li>Login to Github and fork this repository on Github (https://github.com/pnerger/DevNetSlate)</li>
<li>Clone <em>your forked repository</em> (not our original one) to your hard drive with <code class="prettyprint">git clone https://github.com/{YOURUSERNAME}/DevNetSlate.git</code></li>
<li><code class="prettyprint">cd DevNetSlate</code></li>
<li>Install all dependencies: <code class="prettyprint">bundle install</code></li>
<li>Start the test server: <code class="prettyprint">bundle exec middleman server</code></li>
</ol>

<p><strong><em>OR</em></strong></p>

<ol>
<li>Login to Github and download the DevNet Slate Zip file (https://github.com/pnerger/DevNetSlate)</li>
<li>unzip the zip file into the directory that you want to work in.</li>
<li>cd to that directory.</li>
<li>Install all dependencies: <code class="prettyprint">bundle install</code></li>
<li>Start the test server: <code class="prettyprint">bundle exec middleman server</code></li>
</ol>

<p>You can now see the docs using your browser at <a href="http://localhost:4567">http://localhost:4567</a>. And as you edit and save your <code class="prettyprint">source/index.md</code>, your server should automatically update! Whoa! That was fast!</p>
<h1 id='how-devnet-slate-works'>How DevNet Slate Works</h1>
<p>Cisco&rsquo;s implementation of Slate is an HTML document generator that is written and executed in Ruby.  The software reads a source-file in Github Flavored Markdown (GFM) that is used to generate an HTML API Reference Manual along with the accompanying Javascript and CSS files.  The Javascript and CSS files are simply included into the HTML that is generated from the GFM File.</p>

<p>It all sounds simple, but it is a bit more complicated than that.  To get a consistent look and feel to Cisco API documentation, we want the authors of API Reference Manuals to use the GFM tags in a particular way such that we get a common and consistent look and feel to Cisco API documents.  It is important to achieve this cross-product consistency for if a developer gets trained and used to on Cisco API Reference manual but now needs to use an API from another business unit, we want to leverage their experience and make the cross training experience simple and pleasant.</p>
<h2 id='structure-of-a-devnet-slate-document'>Structure of a DevNet Slate Document</h2>
<p>As you look at this document, you will notice that there are a couple of feature.  First, to the left is the Table of Contents area.  Next, in the center is the Body of the document, and to the Right (in the dark area) are code examples.  Each of these elements have the following characteristics:</p>
<h3 id='table-of-contents'>Table of Contents</h3>
<p>The TOC panel on the left hand side of the panel is composed of the following elements starting at the top and moving to the bottom:</p>

<ul>
<li>The Logo - this is generated from the logo held in the logo.png file held in the source directory.  We want to use this same Cisco Logo for all documents.</li>
<li>The Table of Contents - DevNet Slate only uses the first three level of headers in the Table of Contents.  By default, on the H1 is normally displayed.  If a user selects a H1 item, the TOC will expand to display the H2 items underneath it.  If the user selects a H2 item, the TOC will expand to display the H3 items underneath it.  Headers from 4 and below are not displayed.</li>
<li>The TOC Footer - for this we want Cisco Copyright Information.</li>
</ul>
<h3 id='document-body'>Document Body</h3>
<p>The body of the document is found in the center panel and contains the main textual description of the API.  It uses a number of different elements and features to communicate what the API actually does and these include:</p>

<ul>
<li>Headers - these are titles of document section of which the H1 and H2 will automatically appear in the TOC</li>
<li>Paragraphs - these are simple paragraphs of text</li>
<li>Bold Text</li>
<li>Italicized Text</li>
<li>Inline Code Text</li>
<li>Tables</li>
<li>Bullet Lists</li>
<li>Number Lists</li>
<li>Hints - These are Green Highlighted Text</li>
<li>Warnings - These are Red Highlighted Text</li>
<li>Notes - These are Blue Highlighted Text</li>
<li>Links - HTML hyperlinks to external documents</li>
</ul>
<h3 id='code-samples'>Code Samples</h3>
<p>The key part of the DevNet Slate format for API documentation is that code samples can be viewed alongside of the API call that they illustrate.  Further sample code can be held simultaneously in several different programming languages (important for SOAP and REST API&rsquo;s).  Because programmers tend to only work in a single language at a time, the DevNet Slate format accommodates this by having the programming language as a tab on the far right panel.  Thus, the developer is able to choose a programming language and then use the documentation in that language without being distracted by any other language.</p>

<p>Sample code is anchored to either the H1 or H2 heading that they are inserted under; that is, they are placed under the Heading and will move up or down with the main text body. Code samples have the following elements that are used to control their placement:</p>

<ul>
<li>Language - there is a tab for each language that is supported and specified in the header.<br></li>
<li>Code Annotations - these are highlighted areas that are not code but used to point out a code section.</li>
<li>Shared Code Samples - it is possible to make code that appears in all of the tabs.</li>
</ul>
<h1 id='specifying-your-gfm-headers'>Specifying Your GFM Headers</h1>
<blockquote>
<p>GFM Headers for this Document</p>
</blockquote>
<pre class="highlight markdown"><span class="nn">---</span>
<span class="s">title</span><span class="pi">:</span> <span class="s">Authoring a DevNet API Reference Manual</span>
<span class="s">languages</span><span class="pi">:</span>
<span class="s">language_tabs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">shell</span><span class="pi">:</span> <span class="s">Sample</span>

<span class="s">toc_footers</span><span class="pi">:</span>
 <span class="pi">-</span> <span class="s">V1.1.3</span>
 <span class="pi">-</span> <span class="s">Copyright &amp;copy; 2014 by Cisco Systems, Inc.</span>
 <span class="pi">-</span> <span class="s">All Rights Reserved.</span>

<span class="s">search</span><span class="pi">:</span> <span class="s">true</span>
<span class="nn">---</span>
</pre>

<p>The source document that is used to generate a DevNet Slate API Reference Manual is a GFM Document.  The GFM document is a plain text document that starts with headers that set some items about the document and include:</p>
<h2 id='setting-the-document-title'>Setting the Document Title</h2>
<p>This is just the name of the document and is a simple text string</p>
<h2 id='turning-on-language-tabs'>Turning on Language Tabs</h2>
<p>There is a <em>language_tab</em> statement for each language that will be on the tab in the Sample Code section of the the document.  The <em>language_tab</em> statement is followed by
one or more lines that contain a statement that contains two blank spaces, a dash, the name of the language for use in encoding the document, an option &ldquo;:&rdquo;, followed by an optional display name for the language.</p>

<p>The name of the language must be recognized by the system such that the display engine will automatically perform syntax highlighting on the code.  The engine supports lots of different languages but for Cisco documents, these are the standard values that we want to use:</p>

<ul>
<li>c++:C++</li>
<li>c#:C#</li>
<li>css:CSS</li>
<li>html:HTML</li>
<li>json:JSON</li>
<li>java:Java</li>
<li>javascript:JavaScript</li>
<li>markdown:GFM</li>
<li>objective-c:Objective-C</li>
<li>perl:Perl</li>
<li>php: PHP</li>
<li>puppet:Puppet</li>
<li>python:Python</li>
<li>ruby:Ruby</li>
<li>shell</li>
<li>xml:XML</li>
<li>yaml:YAML</li>
</ul>

<p><aside class="notice">
Only list the languages that you want to have as tabs in your document.  Each time you list a language as a <em>language_tab</em>, DevNet Slate will automatically create the language
tab regardless if that language is used in the document.
</aside></p>

<p><aside class="notice">
Please use the language tabs as stated above such that the Tabs are consistent between API&rsquo;s.
</aside></p>
<h2 id='the-footer-statement'>The Footer Statement</h2>
<p>The footer statement is used to place text and links at the bottom of the Table of Contents.  For DevNet, we&rsquo;ve decided to use this for two important meta-data elements about your document; version number and copyright statement.</p>
<h3 id='the-document-version-number'>The Document Version Number</h3>
<p>The first item that we want you to put into the footer is the document version number.  For an API Reference Manual, this will typically correspond to the version number of the API.  It should be a string such as:</p>

<p><code class="prettyprint">- V1.3.2.a</code> </p>

<p>which would render as:</p>

<p>V1.3.2.a</p>
<h3 id='the-document-copyright-statement'>The Document Copyright Statement</h3>
<p>The second item to be placed into the footer statement is the Cisco Copyright Statement.  This works best if it is on two lines.  The first line to claim the copyright and the second line to state what rights are being claimed. A typical statement might be as follows:</p>

<p><code class="prettyprint">- Copyright &amp;copy; 2014 by Cisco Systems, Inc.</code></p>

<p><code class="prettyprint">- All Rights Reserved.</code> </p>

<p>which would render as:</p>

<p>Copyright &copy; 2014 by Cisco Systems, Inc.</p>

<p>All Rights Reserved.</p>

<p><aside class="notice">
Make sure that you put the proper years that the document was created and updated in the copyright statement.  These years should be either a single year or a range of years.  A range of years are used when the document was first published in one year but was subsequently updated in other years.
</aside></p>
<h2 id='turning-on-document-search'>Turning on Document Search</h2>
<p>DevNet Slate has the option of providing readers with a local search.  When you insert the line <code class="prettyprint">search: true</code> into your header, the search option becomes enabled and a search box will appear in the Table of Contents right below the logo.</p>

<p>When a user types in text into the search box, the Table of Contents is automatically filtered to remove sections that do not contain the search term.  Text that matches the search term will be highlighted with a yellow background.</p>
<h1 id='creating-a-table-of-contents'>Creating a Table of Contents</h1>
<p>The Table of Contents (ToC) of a document is automatically generated from the Headers found in your GFM source document.  In GFM, headers are denoted using one or more <code class="prettyprint">#</code> characters. For DevNet Slate, only the first two levels of Headers will be written to the Table of Contents.  H1 Headers are found in the basic TOC while the H2 headers will pop up into the display when the user scrolls down to that area.</p>
<h1 id='creating-the-body-of-the-api-reference'>Creating the Body of the API Reference</h1><h2 id='creating-headers'>Creating Headers</h2>
<p>Headers are created by using one or more # characters starting in the first line of text within the GFM document. The sample to the right shows GFM that will result in a level 1, level 2, and level 3 headers.  Only the level 1 and level 2 headers will appear in the Table of Contents.  When you create sample code, it will anchor to a header.</p>

<p>On the right are a list of headers in markdown and below is how they will appear in the document:</p>

<blockquote>
<p>Headings - Only H1 and H2 are shown in the TOC</p>
</blockquote>
<pre class="highlight markdown">
<span class="gh"># H1 Header</span>
<span class="gu">## H2 Header</span>
<span class="gu">### H3 Header</span>
<span class="gu">#### H4 Header</span>
<span class="gu">#### H5 Header</span>
<span class="gu">#### H6 Header</span>

</pre>
<h1 id='h1-header'>H1 Header</h1><h2 id='h2-header'>H2 Header</h2><h3 id='h3-header'>H3 Header</h3><h4 id='h4-header'>H4 Header</h4><h4 id='h5-header'>H5 Header</h4><h4 id='h6-header'>H6 Header</h4>
<p><aside class="notice">
Remember that only level 1, 2, and 3 headers will appear in the Table of Contents.
</aside></p>
<h2 id='creating-a-paragraphs'>Creating a Paragraphs</h2>
<p>For normal text, just type your paragraph on a single line.</p>

<p>This is some paragraph text. Exciting, no?</p>

<p>Make sure the lines above below your paragraph are empty.</p>
<h2 id='creating-formatted-text'>Creating Formatted Text</h2>
<blockquote>
<p>Formatting Text in GFM</p>
</blockquote>
<pre class="highlight markdown">    This text is <span class="gs">**bold**</span>, this is <span class="ge">*italic*</span>, and this is an<span class="sb">

    `
    Inline code block in the main section.
    `

    You can also use underscores to create __bold__ or _italic_.

    Finally, you can combine ***bold and italic***.

</span></pre>

<p>This text is <strong>bold</strong>, this is <em>italic</em>, and this is an</p>

<p><code class="prettyprint">Inline code block in the main section.</code></p>

<p>You can also use underscores to create <strong>bold</strong> or <em>italic</em>.</p>

<p>Finally, you can combine <strong><em>bold and italic</em></strong>.</p>

<p><aside class="success">
You can use those formatting rules in code annotations, tables, paragraphs, lists, wherever.
</aside></p>
<h2 id='strikethrough'>Strikethrough</h2><pre class="highlight markdown">
Strikethrough allows you to show text that is ~~no longer relevant by using strikethrough~~<span class="sb">


</span></pre>

<p>You can format text with a strikethrough by enclosing the text in double tildes, <code class="prettyprint">~~</code>.  The example to the right becomes:</p>

<p>Strikethrough allows you to show text that is <del>no longer relevant by using strikethrough</del></p>
<h2 id='creating-markdown-links'>Creating Markdown Links</h2>
<blockquote>
<p>The Three Ways to Create GFM Links</p>
</blockquote>
<pre class="highlight markdown">Here's an inline link to <span class="p">[</span><span class="nv">Google</span><span class="p">](</span><span class="sx">http://www.google.com/</span><span class="p">)</span>.
Here's a reference-style link to <span class="p">[</span><span class="nv">Google</span><span class="p">][</span><span class="ss">1</span><span class="p">]</span>.
Here's a very readable link to <span class="p">[</span><span class="nv">Yahoo!</span><span class="p">][</span><span class="ss">yahoo</span><span class="p">]</span>.<span class="sb">



</span></pre>

<p>There are three ways to write links in GFM. Each is easier to read than the last.  The code to the right will generate the following:</p>

<p>Here&rsquo;s an inline link to <a href="http://www.google.com/">Google</a>.
Here&rsquo;s a reference-style link to <a href="http://www.google.com/">Google</a>.
Here&rsquo;s a very readable link to <a href="http://www.yahoo.com/">Yahoo!</a>.</p>

<p>The link definitions can appear anywhere in the document &ndash; before or after the place where you use them. The link definition names <a href="http://www.google.com/">1</a> and <a href="http://www.yahoo.com/">yahoo</a> can be any unique string, and are case-insensitive; <a href="http://www.yahoo.com/">yahoo</a> is the same as <a href="http://www.yahoo.com/">YAHOO</a>.</p>
<h2 id='using-html-standard-links'>Using HTML Standard Links</h2>
<blockquote>
<p>Using HTML Links in GRM</p>
</blockquote>
<pre class="highlight html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"http://developer.cisco.com"</span> <span class="na">title=</span><span class="s">"DevNet"</span><span class="nt">&gt;</span>Cisco DevNet<span class="nt">&lt;/a&gt;</span>
</pre>

<p>You can also use standard HTML hyperlink syntax.  The HTML example to the right produces the text below:</p>

<p><a href="http://developer.cisco.com" title="DevNet">Cisco DevNet</a></p>
<h2 id='inserting-an-image'>Inserting an Image</h2>
<blockquote>
<p>GFM for Inserting an Image Stored Locally</p>
</blockquote>
<pre class="highlight markdown"><span class="p">![</span><span class="nv">Cisco Logo</span><span class="p">](</span><span class="sx">/images/logo.png</span><span class="p">)</span>.
</pre>

<p><img alt="Cisco Logo" src="images/logo.png" />.</p>

<p>The Markdown to the right shows how an image can be inserted, in this case, it is the Cisco Logo that is right above this.  The text inside the square brackets, <code class="prettyprint">[Cisco Logo]</code> will become the alt text for the image in the HTML <code class="prettyprint">alt=</code> parameter.</p>

<p><aside class="success">
Images essentially look just like a link except that they start with a &lsquo;!&rsquo; .
</aside></p>

<p><aside class="notice">
Notice that this image is coming from the local image folder.  We recommend that you place your images inside the image folder within your source directory.
</aside></p>
<h2 id='inserting-horizontal-rules'>Inserting Horizontal Rules</h2>
<p>Sometimes you just need a Horizontal Rule (line) to convey something.  GFM does this with either three or more consecutive Hyphens <code class="prettyprint">-</code>, Asterisks <code class="prettyprint">*</code>, or Underscores <code class="prettyprint">_</code>.</p>
<pre class="highlight markdown">Three or more...
<span class="p">
---
</span>
Hyphens
<span class="p">
***
</span>
Asterisks

<span class="ge">__</span>_

Underscores
</pre>

<p>Three or more&hellip;</p>

<hr>

<p>Hyphens</p>

<hr>

<p>Asterisks</p>

<hr>

<p>Underscores</p>
<h2 id='using-html-in-markdown'>Using HTML in Markdown</h2><pre class="highlight markdown"><span class="nt">&lt;dl&gt;</span>
  <span class="nt">&lt;dt&gt;</span>Definition list<span class="nt">&lt;/dt&gt;</span>
  <span class="nt">&lt;dd&gt;</span>Is something people use sometimes.<span class="nt">&lt;/dd&gt;</span>

  <span class="nt">&lt;dt&gt;</span>Markdown in HTML<span class="nt">&lt;/dt&gt;</span>
  <span class="nt">&lt;dd&gt;</span>Does <span class="ge">*not*</span> work <span class="gs">**very**</span> well. Use HTML <span class="nt">&lt;em&gt;</span>tags<span class="nt">&lt;/em&gt;</span>.<span class="nt">&lt;/dd&gt;</span>
<span class="nt">&lt;/dl&gt;</span>
</pre>

<p>You can also use raw HTML in your Markdown, and it&rsquo;ll mostly work pretty well.</p>

<dl>
  <dt>Definition list</dt>
  <dd>Is something people use sometimes.</dd>

  <dt>Markdown in HTML</dt>
  <dd>Does *not* work **very** well. Use HTML <em>tags</em>.</dd>
</dl>

<p><aside class="warning">
Just because you can, doesn&rsquo;t mean that you should.  One of the features of Markdown is that you don&rsquo;t have to worry about the formatting details of HTML.  Also, it provides
a separation of content and format which you loose when you start placing HTML into your Markdown.
</aside></p>
<h2 id='creating-a-table'>Creating a Table</h2>
<blockquote>
<p>GFM for Creating a Table</p>
</blockquote>
<pre class="highlight markdown">Table Header 1 | Table Header 2 | Table Header 3
-------------- | -------------: | :------------:
Row 1 col 1 | Row 1 col 2 | Row 1 col 3
Row 2 col 1 | Row 2 col 2 | Row 2 col 3
</pre>

<p>Slate uses PHP Markdown Extra style tables.  The example to the right will create the table below.</p>

<table><thead>
<tr>
<th>Table Header 1</th>
<th style="text-align: right">Table Header 2</th>
<th style="text-align: center">Table Header 3</th>
</tr>
</thead><tbody>
<tr>
<td>Row 1 col 1</td>
<td style="text-align: right">Row 1 col 2</td>
<td style="text-align: center">Row 1 col 3</td>
</tr>
<tr>
<td>Row 2 col 1</td>
<td style="text-align: right">Row 2 col 2</td>
<td style="text-align: center">Row 2 col 3</td>
</tr>
</tbody></table>

<p>Notice the colons in the line underneath the header line.  These are used align that columns of the table. A no colon or only a colon to the left will cause the column to align to the left.  A colon to the right will cause the column to align right.  And a colon to the left and the right will cause the column to center.</p>

<p><aside class="notice"> Note that the pipes do not need to line up with each other on each line.</aside></p>

<p><aside class="success"> If you don&rsquo;t like that syntax, feel free to use normal html &lt;table&gt;`s directly in your markdown.</aside></p>
<h2 id='creating-numbered-lists'>Creating Numbered Lists</h2>
<blockquote>
<p>GFM for Numbered Lists</p>
</blockquote>
<pre class="highlight markdown"><span class="p">1.</span> This
<span class="p">2.</span> Is
<span class="p">  3.</span> Nested
<span class="p">  6.</span> Number
<span class="p">  1.</span> List
<span class="p">3.</span> An
<span class="p">8.</span> Ordered
<span class="p">9.</span> List
</pre>

<p>Numbered lists are created using the GFM markdown code to the right.  You can create nested lists, but the bullets are indented by two spaces.  The sample code to the right will create the list below:</p>

<ol>
<li>This</li>
<li>Is

<ol>
<li>Nested</li>
<li>Number</li>
<li>List</li>
</ol></li>
<li>An</li>
<li>Ordered</li>
<li>List</li>
</ol>

<p><aside class="notice"> Notice that the order of the numbers do not make a difference.  It is just that a number is used that makes an ordered list. </aside></p>

<p><aside class="notice"> Note that by indenting by two characters, you are creating an indented list and the numbering restarts and when you go back, the
numbering resumes.</aside></p>
<h2 id='creating-bulleted-lists'>Creating Bulleted Lists</h2>
<blockquote>
<p>GFM for created bullet lists</p>
</blockquote>
<pre class="highlight markdown"><span class="p">-</span> This
<span class="p">+</span> Is
<span class="p">  *</span> nested
<span class="p">  -</span> bullet
<span class="p">*</span> A
<span class="p">*</span> Bullet
<span class="p">*</span> List
</pre>

<p>Numbered lists are created using the GFM markdown code to the right.  you can create nested lists, but the bullets are indented by two spaces.  The sample code
to the right will create the list below:</p>

<ul>
<li>This</li>
<li>Is</li>
<li>A

<ul>
<li>nested</li>
<li>bullet</li>
</ul></li>
<li>Bullet</li>
<li>List</li>
</ul>

<p><aside class="notice"> Notice that bullet lists can be created using a -, a +, or an *. </aside></p>

<p><aside class="notice"> Note that by indenting by two characters, you are creating an indented list.</aside></p>
<h2 id='creating-special-notes-and-warnings'>Creating Special Notes and Warnings</h2>
<blockquote>
<p>GFM for creating Notes and Warnings</p>
</blockquote>
<pre class="highlight html"><span class="nt">&lt;aside</span> <span class="na">class=</span><span class="s">"notice"</span><span class="nt">&gt;</span> This is a sample note. <span class="nt">&lt;/aside&gt;</span>

<span class="nt">&lt;aside</span> <span class="na">class=</span><span class="s">"warning"</span><span class="nt">&gt;</span> This is a sample warning.<span class="nt">&lt;/aside&gt;</span>

<span class="nt">&lt;aside</span> <span class="na">class=</span><span class="s">"success"</span><span class="nt">&gt;</span> This is a sample hint.<span class="nt">&lt;/aside&gt;</span>
</pre>

<p>You can add little highlighted warnings and notes with just a little HTML embedded in your markdown document.  To the right, are three different examples of highlights using markdown.  Below you will see how each of the three examples will manifest themselves in the final document.</p>

<p><aside class="notice"> This is a sample note. </aside></p>

<p><aside class="warning"> This is a sample warning.</aside></p>

<p><aside class="success"> This is a sample hint.</aside></p>

<p>Use <code class="prettyprint">class=&quot;notice&quot;</code> for blue notes, <code class="prettyprint">class=&quot;warning&quot;</code> for red warnings, and <code class="prettyprint">class=&quot;success&quot;</code> for green notes.</p>
<h1 id='sample-code'>Sample Code</h1>
<blockquote>
<p>Sample GFM to Denote Sample Code</p>
</blockquote>
<pre class="highlight markdown">    <span class="sb">```</span>python
    // this is some python code
    <span class="p">```</span>
    <span class="p">```</span>ruby
    # this is some ruby code
    <span class="sb">```</span>
</pre>

<p>Code samples are an important way of communicating how to use an API.  DevNet Slate does an excellent job of handling code samples in multiple languages simultaneously through the use of the tabbed sample code panel on the right hand side.</p>
<h2 id='inserting-large-code-samples'>Inserting Large Code Samples</h2>
<blockquote>
<p>Large Python Program</p>
</blockquote>
<pre class="highlight python">
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">bs4.dammit</span> <span class="kn">import</span> <span class="n">EntitySubstitution</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">next</span>
<span class="k">except</span> <span class="nb">NameError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">bs4._compatibility</span> <span class="kn">import</span> <span class="n">next_function</span> <span class="k">as</span> <span class="nb">next</span>


<span class="n">DEFAULT_OUTPUT_ENCODING</span> <span class="o">=</span> <span class="s">"utf-8"</span>
<span class="n">PY3K</span> <span class="o">=</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">whitespace_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">"</span><span class="err">\</span><span class="s">s+"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_alias</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
    <span class="s">"""Alias one attribute name to another for backward compatibility"""</span>
    <span class="k">def</span> <span class="nf">_get_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="n">alias</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_alias</span><span class="p">,</span> <span class="n">_set_alias</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">alias</span>


<span class="k">class</span> <span class="nc">NamespacedAttribute</span><span class="p">(</span><span class="nb">unicode</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">unicode</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">unicode</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">namespace</span>
        <span class="k">return</span> <span class="n">obj</span>


<span class="k">class</span> <span class="nc">PageElement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="s">"""Contains the navigational information for some part of the page
    (either a tag or a piece of text)"""</span>

    <span class="c"># There are five possible values for the "formatter" argument passed in</span>
    <span class="c"># to methods like encode() and prettify():</span>
    <span class="c">#</span>
    <span class="c"># "html" - All Unicode characters with corresponding HTML entities</span>
    <span class="c">#   are converted to those entities on output.</span>
    <span class="c"># "minimal" - Bare ampersands and angle brackets are converted to</span>
    <span class="c">#   XML entities: &amp;amp; &amp;lt; &amp;gt;</span>
    <span class="c"># None - The null formatter. Unicode characters are never</span>
    <span class="c">#   converted to entities.  This is not recommended, but it's</span>
    <span class="c">#   faster than "minimal".</span>
    <span class="c"># A function - This function will be called on every string that</span>
    <span class="c">#  needs to undergo entity substition</span>
    <span class="n">FORMATTERS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"html"</span> <span class="p">:</span> <span class="n">EntitySubstitution</span><span class="o">.</span><span class="n">substitute_html</span><span class="p">,</span>
        <span class="s">"minimal"</span> <span class="p">:</span> <span class="n">EntitySubstitution</span><span class="o">.</span><span class="n">substitute_xml</span><span class="p">,</span>
        <span class="bp">None</span> <span class="p">:</span> <span class="bp">None</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">previous_element</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""Sets up the initial relations between this element and
        other elements."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_element</span> <span class="o">=</span> <span class="n">previous_element</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_element</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_sibling</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_sibling</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">contents</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_sibling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_sibling</span><span class="o">.</span><span class="n">next_sibling</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="n">nextSibling</span> <span class="o">=</span> <span class="n">_alias</span><span class="p">(</span><span class="s">"next_sibling"</span><span class="p">)</span>  <span class="c"># BS3</span>
    <span class="n">previousSibling</span> <span class="o">=</span> <span class="n">_alias</span><span class="p">(</span><span class="s">"previous_sibling"</span><span class="p">)</span>  <span class="c"># BS3</span>

    <span class="k">def</span> <span class="nf">replace_with</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replace_with</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">replace_with</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">replace_with</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"Cannot replace a Tag with its parent."</span><span class="p">)</span>
        <span class="n">old_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">my_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">replace_with</span><span class="p">,</span> <span class="s">'parent'</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">replace_with</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
            <span class="c"># We're replacing this element with one of its siblings.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">replace_with</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">my_index</span><span class="p">:</span>
                <span class="c"># Furthermore, it comes before this element. That</span>
                <span class="c"># means that when we extract it, the index of this</span>
                <span class="c"># element will change.</span>
                <span class="n">my_index</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
        <span class="n">old_parent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">my_index</span><span class="p">,</span> <span class="n">replace_with</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="n">replaceWith</span> <span class="o">=</span> <span class="n">replace_with</span>  <span class="c"># BS3</span>

    <span class="k">def</span> <span class="nf">replace_with_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">my_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">my_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">[:]):</span>
            <span class="n">my_parent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">my_index</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="n">replaceWithChildren</span> <span class="o">=</span> <span class="n">replace_with_children</span>  <span class="c"># BS3</span>

    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Destructively rips this element out of the tree."""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>

        <span class="c">#Find the two elements that would be next to each other if</span>
        <span class="c">#this element (and any children) hadn't been parsed. Connect</span>
        <span class="c">#the two.</span>
        <span class="n">last_child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_descendant</span><span class="p">()</span>
        <span class="n">next_element</span> <span class="o">=</span> <span class="n">last_child</span><span class="o">.</span><span class="n">next_element</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_element</span><span class="o">.</span><span class="n">next_element</span> <span class="o">=</span> <span class="n">next_element</span>
        <span class="k">if</span> <span class="n">next_element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">next_element</span><span class="o">.</span><span class="n">previous_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_element</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_element</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">last_child</span><span class="o">.</span><span class="n">next_element</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_sibling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_sibling</span><span class="o">.</span><span class="n">next_sibling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_sibling</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_sibling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_sibling</span><span class="o">.</span><span class="n">previous_sibling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_sibling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_sibling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_sibling</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_last_descendant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"Finds the last element beneath this object to be parsed."</span>
        <span class="n">last_child</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">last_child</span><span class="p">,</span> <span class="s">'contents'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">last_child</span><span class="o">.</span><span class="n">contents</span><span class="p">:</span>
            <span class="n">last_child</span> <span class="o">=</span> <span class="n">last_child</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">last_child</span>
    <span class="c"># BS3: Not part of the API!</span>
    <span class="n">_lastRecursiveChild</span> <span class="o">=</span> <span class="n">_last_descendant</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">new_child</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">new_child</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"Cannot insert a tag into itself."</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">new_child</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_child</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">)):</span>
            <span class="n">new_child</span> <span class="o">=</span> <span class="n">NavigableString</span><span class="p">(</span><span class="n">new_child</span><span class="p">)</span>

        <span class="n">position</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_child</span><span class="p">,</span> <span class="s">'parent'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_child</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># We're 'inserting' an element that's already one</span>
            <span class="c"># of this object's children.</span>
            <span class="k">if</span> <span class="n">new_child</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">new_child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">position</span><span class="p">:</span>
                    <span class="c"># Furthermore we're moving it further down the</span>
                    <span class="c"># list of this object's children. That means that</span>
                    <span class="c"># when we extract this element, our target index</span>
                    <span class="c"># will jump down one.</span>
                    <span class="n">position</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">new_child</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>

        <span class="n">new_child</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">previous_child</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_child</span><span class="o">.</span><span class="n">previous_sibling</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">new_child</span><span class="o">.</span><span class="n">previous_element</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">previous_child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="n">position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">new_child</span><span class="o">.</span><span class="n">previous_sibling</span> <span class="o">=</span> <span class="n">previous_child</span>
            <span class="n">new_child</span><span class="o">.</span><span class="n">previous_sibling</span><span class="o">.</span><span class="n">next_sibling</span> <span class="o">=</span> <span class="n">new_child</span>
            <span class="n">new_child</span><span class="o">.</span><span class="n">previous_element</span> <span class="o">=</span> <span class="n">previous_child</span><span class="o">.</span><span class="n">_last_descendant</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">new_child</span><span class="o">.</span><span class="n">previous_element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">new_child</span><span class="o">.</span><span class="n">previous_element</span><span class="o">.</span><span class="n">next_element</span> <span class="o">=</span> <span class="n">new_child</span>

        <span class="n">new_childs_last_element</span> <span class="o">=</span> <span class="n">new_child</span><span class="o">.</span><span class="n">_last_descendant</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">position</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">):</span>
            <span class="n">new_child</span><span class="o">.</span><span class="n">next_sibling</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">parents_next_sibling</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">while</span> <span class="n">parents_next_sibling</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">parents_next_sibling</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">next_sibling</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
                <span class="k">if</span> <span class="n">parents_next_sibling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c"># We found the element that comes next in the document.</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">parents_next_sibling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">new_childs_last_element</span><span class="o">.</span><span class="n">next_element</span> <span class="o">=</span> <span class="n">parents_next_sibling</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># The last element of this tag is the last element in</span>
                <span class="c"># the document.</span>
                <span class="n">new_childs_last_element</span><span class="o">.</span><span class="n">next_element</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">next_child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="n">position</span><span class="p">]</span>
            <span class="n">new_child</span><span class="o">.</span><span class="n">next_sibling</span> <span class="o">=</span> <span class="n">next_child</span>
            <span class="k">if</span> <span class="n">new_child</span><span class="o">.</span><span class="n">next_sibling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">new_child</span><span class="o">.</span><span class="n">next_sibling</span><span class="o">.</span><span class="n">previous_sibling</span> <span class="o">=</span> <span class="n">new_child</span>
            <span class="n">new_childs_last_element</span><span class="o">.</span><span class="n">next_element</span> <span class="o">=</span> <span class="n">next_child</span>

        <span class="k">if</span> <span class="n">new_childs_last_element</span><span class="o">.</span><span class="n">next_element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">new_childs_last_element</span><span class="o">.</span><span class="n">next_element</span><span class="o">.</span><span class="n">previous_element</span> <span class="o">=</span> <span class="n">new_childs_last_element</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">new_child</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="s">"""Appends the given tag to the contents of this tag."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">),</span> <span class="n">tag</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert_before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predecessor</span><span class="p">):</span>
        <span class="s">"""Makes the given element the immediate predecessor of this one.

        The two elements will have the same parent, and the given element
        will be immediately before this one.
        """</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">predecessor</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"Can't insert an element before itself."</span><span class="p">)</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span>
                <span class="s">"Element has no parent, so 'before' has no meaning."</span><span class="p">)</span>
        <span class="c"># Extract first so that the index won't be screwed up if they</span>
        <span class="c"># are siblings.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predecessor</span><span class="p">,</span> <span class="n">PageElement</span><span class="p">):</span>
            <span class="n">predecessor</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">predecessor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">successor</span><span class="p">):</span>
        <span class="s">"""Makes the given element the immediate successor of this one.

        The two elements will have the same parent, and the given element
        will be immediately after this one.
        """</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">successor</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"Can't insert an element after itself."</span><span class="p">)</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span>
                <span class="s">"Element has no parent, so 'after' has no meaning."</span><span class="p">)</span>
        <span class="c"># Extract first so that the index won't be screwed up if they</span>
        <span class="c"># are siblings.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">successor</span><span class="p">,</span> <span class="n">PageElement</span><span class="p">):</span>
            <span class="n">successor</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">successor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Returns the first item that matches the given criteria and
        appears after this Tag in the document."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_one</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_all_next</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">findNext</span> <span class="o">=</span> <span class="n">find_next</span>  <span class="c"># BS3</span>

    <span class="k">def</span> <span class="nf">find_all_next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Returns all items that match the given criteria and appear
        after this Tag in the document."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_all</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_elements</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">findAllNext</span> <span class="o">=</span> <span class="n">find_all_next</span>  <span class="c"># BS3</span>

    <span class="k">def</span> <span class="nf">find_next_sibling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Returns the closest sibling to this Tag that matches the
        given criteria and appears after this Tag in the document."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_one</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_next_siblings</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">findNextSibling</span> <span class="o">=</span> <span class="n">find_next_sibling</span>  <span class="c"># BS3</span>

    <span class="k">def</span> <span class="nf">find_next_siblings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Returns the siblings of this Tag that match the given
        criteria and appear after this Tag in the document."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_all</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">next_siblings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">findNextSiblings</span> <span class="o">=</span> <span class="n">find_next_siblings</span>   <span class="c"># BS3</span>
    <span class="n">fetchNextSiblings</span> <span class="o">=</span> <span class="n">find_next_siblings</span>  <span class="c"># BS2</span>

    <span class="k">def</span> <span class="nf">find_previous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Returns the first item that matches the given criteria and
        appears before this Tag in the document."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_one</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_all_previous</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">findPrevious</span> <span class="o">=</span> <span class="n">find_previous</span>  <span class="c"># BS3</span>

    <span class="k">def</span> <span class="nf">find_all_previous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Returns all items that match the given criteria and appear
        before this Tag in the document."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_all</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_elements</span><span class="p">,</span>
                           <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">findAllPrevious</span> <span class="o">=</span> <span class="n">find_all_previous</span>  <span class="c"># BS3</span>
    <span class="n">fetchPrevious</span> <span class="o">=</span> <span class="n">find_all_previous</span>    <span class="c"># BS2</span>

    <span class="k">def</span> <span class="nf">find_previous_sibling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Returns the closest sibling to this Tag that matches the
        given criteria and appears before this Tag in the document."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_one</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_previous_siblings</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">findPreviousSibling</span> <span class="o">=</span> <span class="n">find_previous_sibling</span>  <span class="c"># BS3</span>

    <span class="k">def</span> <span class="nf">find_previous_siblings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                               <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Returns the siblings of this Tag that match the given
        criteria and appear before this Tag in the document."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_all</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">previous_siblings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">findPreviousSiblings</span> <span class="o">=</span> <span class="n">find_previous_siblings</span>   <span class="c"># BS3</span>
    <span class="n">fetchPreviousSiblings</span> <span class="o">=</span> <span class="n">find_previous_siblings</span>  <span class="c"># BS2</span>

    <span class="k">def</span> <span class="nf">find_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Returns the closest parent of this Tag that matches the given
        criteria."""</span>
        <span class="c"># NOTE: We can't use _find_one because findParents takes a different</span>
        <span class="c"># set of arguments.</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_parents</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="n">findParent</span> <span class="o">=</span> <span class="n">find_parent</span>  <span class="c"># BS3</span>

    <span class="k">def</span> <span class="nf">find_parents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Returns the parents of this Tag that match the given
        criteria."""</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_all</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">findParents</span> <span class="o">=</span> <span class="n">find_parents</span>   <span class="c"># BS3</span>
    <span class="n">fetchParents</span> <span class="o">=</span> <span class="n">find_parents</span>  <span class="c"># BS2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_element</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">previous</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_element</span>

    <span class="c">#These methods do the real heavy lifting.</span>

    <span class="k">def</span> <span class="nf">_find_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">_find_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"Iterates over a generator looking for things that match."</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">SoupStrainer</span><span class="p">):</span>
            <span class="n">strainer</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">elif</span> <span class="n">text</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">limit</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">attrs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c"># Optimization to find all tags.</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">element</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">generator</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">Tag</span><span class="p">)]</span>
            <span class="c"># Optimization to find all tags with a given name.</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">element</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">generator</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">Tag</span><span class="p">)</span> <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">strainer</span> <span class="o">=</span> <span class="n">SoupStrainer</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Build a SoupStrainer</span>
            <span class="n">strainer</span> <span class="o">=</span> <span class="n">SoupStrainer</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">ResultSet</span><span class="p">(</span><span class="n">strainer</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="n">strainer</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">limit</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">limit</span><span class="p">:</span>
                        <span class="k">break</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="c">#These generators can be used to navigate starting from both</span>
    <span class="c">#NavigableStrings and Tags.</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">next_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_element</span>
        <span class="k">while</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">i</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">next_element</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">next_siblings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_sibling</span>
        <span class="k">while</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">i</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">next_sibling</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">previous_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_element</span>
        <span class="k">while</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">i</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">previous_element</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">previous_siblings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_sibling</span>
        <span class="k">while</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">i</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">previous_sibling</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">while</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">i</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">parent</span>

    <span class="c"># Methods for supporting CSS selectors.</span>

    <span class="n">tag_name_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">'^[a-z0-9]+$'</span><span class="p">)</span>

    <span class="c"># /^(\w+)\[(\w+)([=~\|\^\$\*]?)=?"?([^\]"]*)"?\]$/</span>
    <span class="c">#   \---/  \---/\-------------/    \-------/</span>
    <span class="c">#     |      |         |               |</span>
    <span class="c">#     |      |         |           The value</span>
    <span class="c">#     |      |    ~,|,^,$,* or =</span>
    <span class="c">#     |   Attribute</span>
    <span class="c">#    Tag</span>
    <span class="n">attribselect_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span>
        <span class="s">r'^(?P&lt;tag&gt;</span><span class="err">\</span><span class="s">w+)?</span><span class="err">\</span><span class="s">[(?P&lt;attribute&gt;</span><span class="err">\</span><span class="s">w+)(?P&lt;operator&gt;[=~</span><span class="err">\</span><span class="s">|</span><span class="err">\</span><span class="s">^</span><span class="err">\</span><span class="s">$</span><span class="err">\</span><span class="s">*]?)'</span> <span class="o">+</span>
        <span class="s">r'=?"?(?P&lt;value&gt;[^</span><span class="err">\</span><span class="s">]"]*)"?</span><span class="err">\</span><span class="s">]$'</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_attr_value_as_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""Force an attribute value into a string representation.

        A multi-valued attribute will be converted into a
        space-separated stirng.
        """</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span><span class="s">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_attribute_checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s">''</span><span class="p">):</span>
        <span class="s">"""Create a function that performs a CSS selector operation.

        Takes an operator, attribute and optional value. Returns a
        function that will return True for elements that match that
        combination.
        """</span>
        <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s">'='</span><span class="p">:</span>
            <span class="c"># string representation of `attribute` is equal to `value`</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">el</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">_attr_value_as_string</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s">'~'</span><span class="p">:</span>
            <span class="c"># space-separated list representation of `attribute`</span>
            <span class="c"># contains `value`</span>
            <span class="k">def</span> <span class="nf">_includes_value</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
                <span class="n">attribute_value</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribute_value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">attribute_value</span> <span class="o">=</span> <span class="n">attribute_value</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">attribute_value</span>
            <span class="k">return</span> <span class="n">_includes_value</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s">'^'</span><span class="p">:</span>
            <span class="c"># string representation of `attribute` starts with `value`</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">el</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">_attr_value_as_string</span><span class="p">(</span>
                <span class="n">attribute</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s">'$'</span><span class="p">:</span>
            <span class="c"># string represenation of `attribute` ends with `value`</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">el</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">_attr_value_as_string</span><span class="p">(</span>
                <span class="n">attribute</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s">'*'</span><span class="p">:</span>
            <span class="c"># string representation of `attribute` contains `value`</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">el</span><span class="p">:</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">_attr_value_as_string</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s">'|'</span><span class="p">:</span>
            <span class="c"># string representation of `attribute` is either exactly</span>
            <span class="c"># `value` or starts with `value` and then a dash.</span>
            <span class="k">def</span> <span class="nf">_is_or_starts_with_dash</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
                <span class="n">attribute_value</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">_attr_value_as_string</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">attribute_value</span> <span class="o">==</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">attribute_value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
                        <span class="n">value</span> <span class="o">+</span> <span class="s">'-'</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">_is_or_starts_with_dash</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">el</span><span class="p">:</span> <span class="n">el</span><span class="o">.</span><span class="n">has_attr</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="s">"""Perform a CSS selection operation on the current element."""</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">current_context</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribselect_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># Attribute selector</span>
                <span class="n">tag</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">checker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attribute_checker</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">current_context</span><span class="p">:</span>
                    <span class="n">found</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="k">if</span> <span class="n">checker</span><span class="p">(</span><span class="n">el</span><span class="p">)])</span>
                <span class="n">current_context</span> <span class="o">=</span> <span class="n">found</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s">'#'</span> <span class="ow">in</span> <span class="n">token</span><span class="p">:</span>
                <span class="c"># ID selector</span>
                <span class="n">tag</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'#'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">""</span><span class="p">:</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">el</span> <span class="o">=</span> <span class="n">current_context</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="nb">id</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">el</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[]</span> <span class="c"># No match</span>
                <span class="n">current_context</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="p">]</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s">'.'</span> <span class="ow">in</span> <span class="n">token</span><span class="p">:</span>
                <span class="c"># Class selector</span>
                <span class="n">tag</span><span class="p">,</span> <span class="n">klass</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">current_context</span><span class="p">:</span>
                    <span class="n">found</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="n">context</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
                            <span class="n">tag</span><span class="p">,</span>
                            <span class="p">{</span><span class="s">'class'</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">attr</span><span class="p">:</span> <span class="n">attr</span> <span class="ow">and</span> <span class="n">klass</span> <span class="ow">in</span> <span class="n">attr</span><span class="o">.</span><span class="n">split</span><span class="p">()}</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                <span class="n">current_context</span> <span class="o">=</span> <span class="n">found</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="s">'*'</span><span class="p">:</span>
                <span class="c"># Star selector</span>
                <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">current_context</span><span class="p">:</span>
                    <span class="n">found</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="bp">True</span><span class="p">))</span>
                <span class="n">current_context</span> <span class="o">=</span> <span class="n">found</span>
                <span class="k">continue</span>
            <span class="c"># Here we should just have a regular tag</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_name_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">current_context</span><span class="p">:</span>
                <span class="n">found</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="n">token</span><span class="p">))</span>
            <span class="n">current_context</span> <span class="o">=</span> <span class="n">found</span>
        <span class="k">return</span> <span class="n">current_context</span>

    <span class="c"># Old non-property versions of the generators, for backwards</span>
    <span class="c"># compatibility with BS3.</span>
    <span class="k">def</span> <span class="nf">nextGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_elements</span>

    <span class="k">def</span> <span class="nf">nextSiblingGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_siblings</span>

    <span class="k">def</span> <span class="nf">previousGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_elements</span>

    <span class="k">def</span> <span class="nf">previousSiblingGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_siblings</span>

    <span class="k">def</span> <span class="nf">parentGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parents</span>

    <span class="c"># Utility methods</span>
    <span class="k">def</span> <span class="nf">substitute_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span> <span class="ow">or</span> <span class="s">"utf-8"</span>
        <span class="k">return</span> <span class="nb">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">SOUP-ENCODING</span><span class="si">%</span><span class="s">"</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NavigableString</span><span class="p">(</span><span class="nb">unicode</span><span class="p">,</span> <span class="n">PageElement</span><span class="p">):</span>

    <span class="n">PREFIX</span> <span class="o">=</span> <span class="s">''</span>
    <span class="n">SUFFIX</span> <span class="o">=</span> <span class="s">''</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="s">"""Create a new NavigableString.

        When unpickling a NavigableString, this method is called with
        the string in DEFAULT_OUTPUT_ENCODING. That encoding needs to be
        passed in to the superclass's __new__ or the superclass won't know
        how to handle non-ASCII characters.
        """</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">unicode</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">unicode</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">DEFAULT_OUTPUT_ENCODING</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="p">),)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="s">"""text.string gives you text. This is for backwards
        compatibility for Navigable*String, but for CData* it lets you
        get the string without the CData wrapper."""</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">'string'</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">AttributeError</span><span class="p">(</span>
                <span class="s">"'</span><span class="si">%</span><span class="s">s' object has no attribute '</span><span class="si">%</span><span class="s">s'"</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">output_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s">"minimal"</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">formatter</span><span class="p">):</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FORMATTERS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">formatter</span><span class="p">,</span> <span class="n">EntitySubstitution</span><span class="o">.</span><span class="n">substitute_xml</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">formatter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">formatter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PREFIX</span> <span class="o">+</span> <span class="n">output</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUFFIX</span>


<span class="k">class</span> <span class="nc">CData</span><span class="p">(</span><span class="n">NavigableString</span><span class="p">):</span>

    <span class="n">PREFIX</span> <span class="o">=</span> <span class="s">u'&lt;![CDATA['</span>
    <span class="n">SUFFIX</span> <span class="o">=</span> <span class="s">u']]&gt;'</span>


<span class="k">class</span> <span class="nc">ProcessingInstruction</span><span class="p">(</span><span class="n">NavigableString</span><span class="p">):</span>

    <span class="n">PREFIX</span> <span class="o">=</span> <span class="s">u'&lt;?'</span>
    <span class="n">SUFFIX</span> <span class="o">=</span> <span class="s">u'?&gt;'</span>


<span class="k">class</span> <span class="nc">Comment</span><span class="p">(</span><span class="n">NavigableString</span><span class="p">):</span>

    <span class="n">PREFIX</span> <span class="o">=</span> <span class="s">u'&lt;!--'</span>
    <span class="n">SUFFIX</span> <span class="o">=</span> <span class="s">u'--&gt;'</span>


<span class="k">class</span> <span class="nc">Declaration</span><span class="p">(</span><span class="n">NavigableString</span><span class="p">):</span>
    <span class="n">PREFIX</span> <span class="o">=</span> <span class="s">u'&lt;!'</span>
    <span class="n">SUFFIX</span> <span class="o">=</span> <span class="s">u'!&gt;'</span>


<span class="k">class</span> <span class="nc">Doctype</span><span class="p">(</span><span class="n">NavigableString</span><span class="p">):</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">for_name_and_ids</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pub_id</span><span class="p">,</span> <span class="n">system_id</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">pub_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="s">' PUBLIC "</span><span class="si">%</span><span class="s">s"'</span> <span class="o">%</span> <span class="n">pub_id</span>
            <span class="k">if</span> <span class="n">system_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">+=</span> <span class="s">' "</span><span class="si">%</span><span class="s">s"'</span> <span class="o">%</span> <span class="n">system_id</span>
        <span class="k">elif</span> <span class="n">system_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="s">' SYSTEM "</span><span class="si">%</span><span class="s">s"'</span> <span class="o">%</span> <span class="n">system_id</span>

        <span class="k">return</span> <span class="n">Doctype</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="n">PREFIX</span> <span class="o">=</span> <span class="s">u'&lt;!DOCTYPE '</span>
    <span class="n">SUFFIX</span> <span class="o">=</span> <span class="s">u'&gt;</span><span class="se">\n</span><span class="s">'</span>


<span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">PageElement</span><span class="p">):</span>

    <span class="s">"""Represents a found HTML tag with its attributes and contents."""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">builder</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">previous</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"Basic constructor."</span>

        <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser_class</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># We don't actually store the parser object: that lets extracted</span>
            <span class="c"># chunks be garbage-collected.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser_class</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">__class__</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"No value provided for new tag's name."</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namespace</span> <span class="o">=</span> <span class="n">namespace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">builder</span><span class="o">.</span><span class="n">cdata_list_attributes</span><span class="p">:</span>
                <span class="n">universal</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">cdata_list_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'*'</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">tag_specific</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">cdata_list_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">[])</span>
                <span class="k">for</span> <span class="n">cdata_list_attr</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">universal</span><span class="p">,</span> <span class="n">tag_specific</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">cdata_list_attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                        <span class="c"># Basically, we have a "class" attribute whose</span>
                        <span class="c"># value is a whitespace-separated list of CSS</span>
                        <span class="c"># classes. Split it into a list.</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="n">cdata_list_attr</span><span class="p">]</span>
                        <span class="n">values</span> <span class="o">=</span> <span class="n">whitespace_re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="n">attrs</span><span class="p">[</span><span class="n">cdata_list_attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">previous</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># Set up any substitutions, such as the charset in a META tag.</span>
        <span class="k">if</span> <span class="n">builder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contains_substitutions</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">set_up_substitutions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">can_be_empty_element</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">can_be_empty_element</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contains_substitutions</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">can_be_empty_element</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">parserClass</span> <span class="o">=</span> <span class="n">_alias</span><span class="p">(</span><span class="s">"parser_class"</span><span class="p">)</span>  <span class="c"># BS3</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_empty_element</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Is this tag an empty-element tag? (aka a self-closing tag)

        A tag that has contents is never an empty-element tag.

        A tag that has no contents may or may not be an empty-element
        tag. It depends on the builder used to create the tag. If the
        builder has a designated list of empty-element tags, then only
        a tag whose name shows up in that list is considered an
        empty-element tag.

        If the builder has no designated list of empty-element tags,
        then any tag with no contents is an empty-element tag.
        """</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_be_empty_element</span>
    <span class="n">isSelfClosing</span> <span class="o">=</span> <span class="n">is_empty_element</span>  <span class="c"># BS3</span>

    <span class="k">def</span> <span class="nf">_get_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Convenience property to get the single string within this tag.

        :Return: If this tag has a single string child, return value
         is that string. If this tag has no children, or more than one
         child, return value is None. If this tag has one child tag,
         return value is the 'string' attribute of the child tag,
         recursively.
        """</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">child</span>
        <span class="k">return</span> <span class="n">child</span><span class="o">.</span><span class="n">string</span>

    <span class="k">def</span> <span class="nf">_set_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="n">string</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_string</span><span class="p">,</span> <span class="n">_set_string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_all_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="s">"""Yield all child strings, possibly stripping them."""</span>
        <span class="k">for</span> <span class="n">descendant</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">descendants</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">descendant</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
                <span class="n">descendant</span> <span class="o">=</span> <span class="n">descendant</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">descendant</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">yield</span> <span class="n">descendant</span>
    <span class="n">strings</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_all_strings</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stripped_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_strings</span><span class="p">(</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">string</span>

    <span class="k">def</span> <span class="nf">get_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="s">"""
        Get all child strings, concatenated using the given separator.
        """</span>
        <span class="k">return</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_strings</span><span class="p">(</span><span class="n">strip</span><span class="p">)])</span>
    <span class="n">getText</span> <span class="o">=</span> <span class="n">get_text</span>
    <span class="n">text</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decompose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Recursively destroys the contents of this tree."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">next</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">next_element</span>
            <span class="n">i</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">next</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decompose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="s">"""
        Extract all children. If decompose is True, decompose instead.
        """</span>
        <span class="k">if</span> <span class="n">decompose</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">[:]:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">Tag</span><span class="p">):</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">[:]:</span>
                <span class="n">element</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="s">"""
        Find the index of a child by identity, not value. Avoids issues with
        tag.contents.index(element) getting the index of equal elements.
        """</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">child</span> <span class="ow">is</span> <span class="n">element</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">i</span>
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"Tag.index: element not in tag"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""Returns the value of the 'key' attribute for the tag, or
        the value given for 'default' if it doesn't have that
        attribute."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">has_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__hash__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="s">"""tag[key] returns the value of the 'key' attribute for the tag,
        and throws an exception if it's not there."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"Iterating over a tag iterates over its contents."</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"The length of a tag is the length of its list of contents."</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span>

    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"A tag is non-None even if it has no contents."</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="s">"""Setting tag[key] sets the value of the 'key' attribute for the
        tag."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="s">"Deleting tag[key] deletes all 'key' attributes for the tag."</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Calling a tag like a function is the same as calling its
        find_all() method. Eg. tag('a') returns a list of all the A tags
        found within this tag."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="c">#print "Getattr %s.%s" % (self.__class__, tag)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">tag</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'Tag'</span><span class="p">):</span>
            <span class="c"># BS3: soup.aTag -&gt; "soup.find("a")</span>
            <span class="n">tag_name</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s">'.</span><span class="si">%</span><span class="s">sTag is deprecated, use .find("</span><span class="si">%</span><span class="s">s") instead.'</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">tag_name</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
        <span class="c"># We special case contents to avoid recursion.</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tag</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"__"</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tag</span><span class="o">==</span><span class="s">"contents"</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">raise</span> <span class="nb">AttributeError</span><span class="p">(</span>
            <span class="s">"'</span><span class="si">%</span><span class="s">s' object has no attribute '</span><span class="si">%</span><span class="s">s'"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="s">"""Returns true iff this tag has the same name, the same attributes,
        and the same contents (recursively) as the given tag."""</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">'name'</span><span class="p">)</span> <span class="ow">or</span>
            <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">'attrs'</span><span class="p">)</span> <span class="ow">or</span>
            <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">'contents'</span><span class="p">)</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">attrs</span> <span class="ow">or</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">my_child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">my_child</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="s">"""Returns true iff this tag is not identical to the other tag,
        as defined in __eq__."""</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">DEFAULT_OUTPUT_ENCODING</span><span class="p">):</span>
        <span class="s">"""Renders this tag as a string."""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">PY3K</span><span class="p">:</span>
        <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span> <span class="o">=</span> <span class="n">__unicode__</span>

    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">DEFAULT_OUTPUT_ENCODING</span><span class="p">,</span>
               <span class="n">indent_level</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s">"minimal"</span><span class="p">,</span>
               <span class="n">errors</span><span class="o">=</span><span class="s">"xmlcharrefreplace"</span><span class="p">):</span>
        <span class="c"># Turn the data structure into Unicode, then encode the</span>
        <span class="c"># Unicode.</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">indent_level</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">formatter</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent_level</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">eventual_encoding</span><span class="o">=</span><span class="n">DEFAULT_OUTPUT_ENCODING</span><span class="p">,</span>
               <span class="n">formatter</span><span class="o">=</span><span class="s">"minimal"</span><span class="p">):</span>
        <span class="s">"""Returns a Unicode representation of this tag and its contents.

        :param eventual_encoding: The tag is destined to be
           encoded into this encoding. This method is _not_
           responsible for performing that encoding. This information
           is passed in so that it can be substituted in if the
           document contains a &lt;META&gt; tag that mentions the document's
           encoding.
        """</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">decoded</span> <span class="o">=</span> <span class="n">key</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="s">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contains_substitutions</span>
                        <span class="ow">and</span> <span class="n">eventual_encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
                        <span class="ow">and</span> <span class="s">'</span><span class="si">%</span><span class="s">SOUP-ENCODING</span><span class="si">%</span><span class="s">'</span> <span class="ow">in</span> <span class="n">val</span><span class="p">):</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">substitute_encoding</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">eventual_encoding</span><span class="p">)</span>

                    <span class="n">decoded</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s">'='</span>
                               <span class="o">+</span> <span class="n">EntitySubstitution</span><span class="o">.</span><span class="n">substitute_xml</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
                <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span>
        <span class="n">close</span> <span class="o">=</span> <span class="s">''</span>
        <span class="n">closeTag</span> <span class="o">=</span> <span class="s">''</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_empty_element</span><span class="p">:</span>
            <span class="n">close</span> <span class="o">=</span> <span class="s">'/'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">closeTag</span> <span class="o">=</span> <span class="s">'&lt;/</span><span class="si">%</span><span class="s">s&gt;'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="n">prefix</span> <span class="o">=</span> <span class="s">''</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s">":"</span>

        <span class="n">pretty_print</span> <span class="o">=</span> <span class="p">(</span><span class="n">indent_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pretty_print</span><span class="p">:</span>
            <span class="n">space</span> <span class="o">=</span> <span class="p">(</span><span class="s">' '</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent_level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">indent_contents</span> <span class="o">=</span> <span class="n">indent_level</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">space</span> <span class="o">=</span> <span class="s">''</span>
            <span class="n">indent_contents</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_contents</span><span class="p">(</span>
            <span class="n">indent_contents</span><span class="p">,</span> <span class="n">eventual_encoding</span><span class="p">,</span> <span class="n">formatter</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="p">:</span>
            <span class="c"># This is the 'document root' object.</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">contents</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">attribute_string</span> <span class="o">=</span> <span class="s">''</span>
            <span class="k">if</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="n">attribute_string</span> <span class="o">=</span> <span class="s">' '</span> <span class="o">+</span> <span class="s">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pretty_print</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'&lt;</span><span class="si">%</span><span class="s">s</span><span class="si">%</span><span class="s">s</span><span class="si">%</span><span class="s">s</span><span class="si">%</span><span class="s">s&gt;'</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">attribute_string</span><span class="p">,</span> <span class="n">close</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">pretty_print</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pretty_print</span> <span class="ow">and</span> <span class="n">contents</span> <span class="ow">and</span> <span class="n">contents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pretty_print</span> <span class="ow">and</span> <span class="n">closeTag</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">closeTag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pretty_print</span> <span class="ow">and</span> <span class="n">closeTag</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_sibling</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">prettify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="s">"minimal"</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="n">formatter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="n">formatter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decode_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent_level</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                       <span class="n">eventual_encoding</span><span class="o">=</span><span class="n">DEFAULT_OUTPUT_ENCODING</span><span class="p">,</span>
                       <span class="n">formatter</span><span class="o">=</span><span class="s">"minimal"</span><span class="p">):</span>
        <span class="s">"""Renders the contents of this tag as a Unicode string.

        :param eventual_encoding: The tag is destined to be
           encoded into this encoding. This method is _not_
           responsible for performing that encoding. This information
           is passed in so that it can be substituted in if the
           document contains a &lt;META&gt; tag that mentions the document's
           encoding.
        """</span>
        <span class="n">pretty_print</span> <span class="o">=</span> <span class="p">(</span><span class="n">indent_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">):</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">output_ready</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Tag</span><span class="p">):</span>
                <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">indent_level</span><span class="p">,</span> <span class="n">eventual_encoding</span><span class="p">,</span>
                                  <span class="n">formatter</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">text</span> <span class="ow">and</span> <span class="n">indent_level</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pretty_print</span><span class="p">:</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">" "</span> <span class="o">*</span> <span class="p">(</span><span class="n">indent_level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pretty_print</span><span class="p">:</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="c">#Soup methods</span>

    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Return only the first child of this Tag matching the given
        criteria."""</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="n">findChild</span> <span class="o">=</span> <span class="n">find</span>

    <span class="k">def</span> <span class="nf">find_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Extracts a list of Tag objects that match the given
        criteria.  You can specify the name of the Tag and any
        attributes you want the Tag to have.

        The value of a key-value pair in the 'attrs' map can be a
        string, a list of strings, a regular expression object, or a
        callable that takes a string and returns whether or not the
        string matches for some custom definition of 'matches'. The
        same is true of the tag name."""</span>
        <span class="n">generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descendants</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="n">generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_all</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">findAll</span> <span class="o">=</span> <span class="n">find_all</span>       <span class="c"># BS3</span>
    <span class="n">findChildren</span> <span class="o">=</span> <span class="n">find_all</span>  <span class="c"># BS2</span>

    <span class="c">#Generator methods</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># return iter() to make the purpose of the method clear</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>  <span class="c"># XXX This seems to be untested.</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">descendants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">stopNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_descendant</span><span class="p">()</span><span class="o">.</span><span class="n">next_element</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">current</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">stopNode</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">current</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">next_element</span>

    <span class="c"># Old names for backwards compatibility</span>
    <span class="k">def</span> <span class="nf">childGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span>

    <span class="k">def</span> <span class="nf">recursiveChildGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">descendants</span>

    <span class="c"># This was kind of misleading because has_key() (attributes) was</span>
    <span class="c"># different from __in__ (contents). has_key() is gone in Python 3,</span>
    <span class="c"># anyway.</span>
    <span class="n">has_key</span> <span class="o">=</span> <span class="n">has_attr</span>

<span class="c"># Next, a couple classes to represent queries and their results.</span>
<span class="k">class</span> <span class="nc">SoupStrainer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="s">"""Encapsulates a number of ways of matching a markup element (tag or
    text)."""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c"># Treat a non-dict value for attrs as a search for the 'class'</span>
            <span class="c"># attribute.</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">'class'</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"</span><span class="si">%</span><span class="s">s|</span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">search_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markup_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">markup_attrs</span><span class="o">=</span><span class="p">{}):</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">markup</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markup_name</span><span class="p">,</span> <span class="n">Tag</span><span class="p">):</span>
            <span class="n">markup</span> <span class="o">=</span> <span class="n">markup_name</span>
            <span class="n">markup_attrs</span> <span class="o">=</span> <span class="n">markup</span>
        <span class="n">call_function_with_tag_data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markup_name</span><span class="p">,</span> <span class="n">Tag</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">((</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">call_function_with_tag_data</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">markup</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matches</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">markup</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matches</span><span class="p">(</span><span class="n">markup_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))):</span>
            <span class="k">if</span> <span class="n">call_function_with_tag_data</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">markup_name</span><span class="p">,</span> <span class="n">markup_attrs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">markup_attr_map</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">match_against</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">markup_attr_map</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">markup_attrs</span><span class="p">,</span> <span class="s">'get'</span><span class="p">):</span>
                            <span class="n">markup_attr_map</span> <span class="o">=</span> <span class="n">markup_attrs</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">markup_attr_map</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">markup_attrs</span><span class="p">:</span>
                                <span class="n">markup_attr_map</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                    <span class="n">attr_value</span> <span class="o">=</span> <span class="n">markup_attr_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matches</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="n">match_against</span><span class="p">):</span>
                        <span class="n">match</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">markup</span><span class="p">:</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="n">markup</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="n">markup_name</span>
        <span class="k">if</span> <span class="n">found</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">!=</span> <span class="n">found</span><span class="o">.</span><span class="n">string</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">found</span>
    <span class="n">searchTag</span> <span class="o">=</span> <span class="n">search_tag</span>

    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markup</span><span class="p">):</span>
        <span class="c"># print 'looking for %s in %s' % (self, markup)</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># If given a list of items, scan it for a text element that</span>
        <span class="c"># matches.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="s">'__iter__'</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">markup</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">)</span> \
                       <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="n">element</span>
                    <span class="k">break</span>
        <span class="c"># If it's a Tag, make sure its name or attributes match.</span>
        <span class="c"># Don't bother with Tags if we're searching for text.</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="n">Tag</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_tag</span><span class="p">(</span><span class="n">markup</span><span class="p">)</span>
        <span class="c"># If it's text, make sure the text matches.</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">)</span> <span class="ow">or</span> \
                 <span class="nb">isinstance</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matches</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">):</span>
                <span class="n">found</span> <span class="o">=</span> <span class="n">markup</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span>
                <span class="s">"I don't know how to match against a </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="n">markup</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">found</span>

    <span class="k">def</span> <span class="nf">_matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markup</span><span class="p">,</span> <span class="n">match_against</span><span class="p">):</span>
        <span class="c"># print "Matching %s against %s" % (markup, match_against)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="c"># This should only happen when searching, e.g. the 'class'</span>
            <span class="c"># attribute.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">match_against</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span>
                <span class="ow">and</span> <span class="s">' '</span> <span class="ow">in</span> <span class="n">match_against</span><span class="p">):</span>
                <span class="c"># A bit of a special case. If they try to match "foo</span>
                <span class="c"># bar" on a multivalue attribute's value, only accept</span>
                <span class="c"># the literal value "foo bar"</span>
                <span class="c">#</span>
                <span class="c"># XXX This is going to be pretty slow because we keep</span>
                <span class="c"># splitting match_against. But it shouldn't come up</span>
                <span class="c"># too often.</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">whitespace_re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">match_against</span><span class="p">)</span> <span class="o">==</span> <span class="n">markup</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">markup</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matches</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">match_against</span><span class="p">):</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">match_against</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">markup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">match_against</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">match_against</span><span class="p">(</span><span class="n">markup</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#Custom match methods take the tag as an argument, but all</span>
            <span class="c">#other ways of matching match the tag name as a string.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="n">Tag</span><span class="p">):</span>
                <span class="n">markup</span> <span class="o">=</span> <span class="n">markup</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">markup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">markup</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">markup</span><span class="p">)</span>
            <span class="c">#Now we know that chunk is either a string, or None.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">match_against</span><span class="p">,</span> <span class="s">'match'</span><span class="p">):</span>
                <span class="c"># It's a regexp object.</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">markup</span> <span class="ow">and</span> <span class="n">match_against</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">markup</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">match_against</span><span class="p">,</span> <span class="s">'__iter__'</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">markup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match_against</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">markup</span> <span class="ow">in</span> <span class="n">match_against</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">match_against</span><span class="p">,</span> <span class="s">'items'</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">markup</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match_against</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">match_against</span> <span class="ow">in</span> <span class="n">markup</span>
            <span class="k">elif</span> <span class="n">match_against</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markup</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">match_against</span> <span class="o">=</span> <span class="n">markup</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">match_against</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">match_against</span> <span class="o">==</span> <span class="n">markup</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="k">class</span> <span class="nc">ResultSet</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="s">"""A ResultSet is just a list that keeps track of the SoupStrainer
    that created it."""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">__init__</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>

</pre>

<p>Sometimes you will need to insert a very large block of sample code that might be too wide or extremely deep.  DevNet Slate manages this by automatically creating vertical and horizontal scroll bars such that the sample code is preserved without taking up too much space.  The example to the right is an extremely large python program pulled from the Internet.  There is no wrapping of text, instead, your readers need to use horizontal scrolling to see the full code sample.  Also, it is very long, but a maximum height of 50 cm has been set for the display area.  If your sample code exceeds this, then DevNet Slate will also provide vertical scrolling such that the space is better managed. </p>
<h2 id='inserting-a-sample-code-into-a-particular-tab'>Inserting a Sample Code into a Particular Tab</h2>
<p>You denote a code samples by using three left-single-quote marks followed by the name of the language.  The name of the language is used to place the code sample into the proper tab. Each code samples will appear in the dark area to the right of the main text. Code samples need to appear right under the Level 1 or Level 2 headers in your markdown file to allow them to be anchored properly.</p>

<p>The &ldquo;language tabs&rdquo; are the tabs that appear in the upper right of DevNet Slate Documents. Users browsing the docs use them to select their programming language of choice.</p>

<p>In the sample GFM code to the right, the Ruby code will appear in the Ruby tab, while the Python code will appear in the Python tab. Because the DevNet Slate engine understands the syntax of most computer programming languages, the sample code will have its language syntax highlighted automatically in a way that would make sense to the developer.</p>

<p>But just because a language is used as sample code within a DevNet Slate document it does not mean that the tab will appear.  You tell the system which Language tabs you want to display by editing the <code class="prettyprint">language-tabs</code> list at the top of your GFM source document.</p>

<p><aside class="success"> Sometimes it is useful to share code between multiple tabs, you can do this by placing tagging the sample code using a language that is not used as a tab name.  For example if you tag sample code as <code class="prettyprint">all</code> and <code class="prettyprint">all</code> is not listed in the <code class="prettyprint">language-tabs</code> then that sample code will appear in all of the tabs.</aside></p>
<h2 id='creating-code-sample-annotations'>Creating Code Sample Annotations</h2>
<blockquote>
<p>Code Sample Annotations</p>
</blockquote>
<pre class="highlight markdown"><span class="gt">&gt; This is a Code Annotation!</span>
</pre>

<p>It is sometimes useful to highlight or annotate a part of the sample code.  This is done with code annotations.  By placing a &gt; as the first character in your GFM line of text, you will create a code annotation that will appear in the area to the right, next to the code samples.</p>

<p><aside class="warning"> Make sure that you have a blank line after your Code Annotation.  If you do not, the annotation will continue until there is a blank line.
</aside></p>
<h1 id='fun-with-the-right-hand-panel'>Fun with the Right Hand Panel</h1>
<p>When you use the chevron <code class="prettyprint">&gt;</code> symbol, it takes the entire line and places it into the pannel to the right. Since it does not have a language, it will appear on all of the tabs to the right.  Additionally, because it is not &ldquo;code&rdquo; it is not treated as pre-formatted text.  As a result of these factors, the annotation feature can be very useful for placing Markdown or even HTML into the right hand panel.</p>
<h2 id='a-markdown-table'>A Markdown Table</h2>
<blockquote>
<p>The following markdown code:</p>
</blockquote>
<pre class="highlight markdown"><span class="gt">
&gt; Table Header 1 | Table Header 2 | Table Header 3</span>
<span class="gt">&gt; -------------- | -------------: | :------------:</span>
<span class="gt">&gt; Row 1 col 1 | Row 1 col 2 | Row 1 col 3</span>
<span class="gt">&gt; Row 2 col 1 | Row 2 col 2 | Row 2 col 3 </span>

</pre>

<blockquote>
<p>will result in the table in the right hand panel:</p>

<table><thead>
<tr>
<th>Table Header 1</th>
<th style="text-align: right">Table Header 2</th>
<th style="text-align: center">Table Header 3</th>
</tr>
</thead><tbody>
<tr>
<td>Row 1 col 1</td>
<td style="text-align: right">Row 1 col 2</td>
<td style="text-align: center">Row 1 col 3</td>
</tr>
<tr>
<td>Row 2 col 1</td>
<td style="text-align: right">Row 2 col 2</td>
<td style="text-align: center">Row 2 col 3</td>
</tr>
</tbody></table>
</blockquote>

<p>For example, I can use the <code class="prettyprint">&gt;</code> to place a table into the right hand panel.</p>
<h2 id='an-image'>An Image</h2>
<blockquote>
<p>The following markdown code:</p>
</blockquote>
<pre class="highlight markdown"><span class="gt">
&gt; ![Cisco Logo](/images/logo.png).</span>

</pre>

<blockquote>
<p>will result in the image placed into the right hand panel:</p>

<p><img alt="Cisco Logo" src="images/logo.png" /></p>
</blockquote>

<p>Or, I can use the <code class="prettyprint">&gt;</code> to place an image into the right hand panel.  I can even use the <code class="prettyprint">&gt;</code> to place HTML code such as a YouTube video or any other content.</p>
<h1 id='creating-your-devnet-slate-document'>Creating your DevNet Slate Document</h1><h2 id='previewing-your-docs'>Previewing your Docs</h2>
<blockquote>
<p>Command to Start Your Preview Server</p>
</blockquote>
<pre class="highlight markdown">bundle exec middleman server
</pre>

<blockquote>
<p>Output:</p>
</blockquote>
<pre class="highlight markdown">  == The Middleman is loading
  == The Middleman is standing watch at http://0.0.0.0:4567
  == Inspect your site configuration at http://0.0.0.0:4567/__middleman/
</pre>
<h2 id='building-your-docs-if-you-forked-and-cloned'>Building Your Docs If You Forked and Cloned</h2>
<blockquote>
<p>Command to create your HTML Files</p>
</blockquote>
<pre class="highlight markdown">rake build
</pre>

<blockquote>
<p>Output:</p>
</blockquote>
<pre class="highlight markdown">cd DevNetSlate
bundle exec middleman build --clean
      create  build/images/logo.png
      create  build/images/Untitled.png
      create  build/fonts/icomoon.svg
      create  build/fonts/icomoon.woff
      create  build/fonts/icomoon.ttf
      create  build/fonts/icomoon.eot
      create  build/javascripts/lang_selector.js
      create  build/javascripts/all.js
      create  build/javascripts/jquery_ui.js
      create  build/javascripts/jquery.tocify.js
      create  build/stylesheets/variables.css
      create  build/stylesheets/icon-font.css
      create  build/stylesheets/normalize.css
      create  build/stylesheets/syntax.css
      create  build/stylesheets/screen.css
      create  build/stylesheets/print.css
      create  build/index.html
cd -
</pre>

<p>The <code class="prettyprint">rake build</code> command tells Middleman to build your website to the <code class="prettyprint">build</code> directory of your project in a way that is Github compatible.  You then need to share those static HTML files with the DevNet team for publishing.  You can do this via Box.net or Dropbox.</p>
<h2 id='building-your-docs-if-you-installed-from-zip'>Building Your Docs If You Installed From Zip</h2>
<blockquote>
<p>Command to create your HTML Files</p>
</blockquote>
<pre class="highlight markdown">bundle exec middleman build --clean

</pre>

<blockquote>
<p>Output:</p>
</blockquote>
<pre class="highlight markdown">      create  build/images/logo.png
      create  build/images/Untitled.png
      create  build/fonts/icomoon.svg
      create  build/fonts/icomoon.woff
      create  build/fonts/icomoon.ttf
      create  build/fonts/icomoon.eot
      create  build/javascripts/lang_selector.js
      create  build/javascripts/all.js
      create  build/javascripts/jquery_ui.js
      create  build/javascripts/jquery.tocify.js
      create  build/stylesheets/variables.css
      create  build/stylesheets/icon-font.css
      create  build/stylesheets/normalize.css
      create  build/stylesheets/syntax.css
      create  build/stylesheets/screen.css
      create  build/stylesheets/print.css
      create  build/index.html
</pre>

<p>The Middleman <em>build</em> option builds your document to the <code class="prettyprint">build</code> directory of your project.</p>
<h2 id='getting-your-document-on-devnet'>Getting Your Document On DevNet</h2>
<p>Once you have built and tested your document using DevNet Slate, you can now get it publish it on DevNet.  You will need to raise a ticket to get your new static HTML files on DevNet for publishing.  You can do this by placing your build directory (with all subdirectories) into a zip, a Box.net folder or a Dropbox folder that you can share with the DevNet team. </p>
<h1 id='elements-of-style-for-cisco-apis39'>Elements of Style for Cisco APIs&#39;</h1>
<p>Now that you understand the mechanics of DevNet Slate.  Now we need to get into the specifics of how to use these tools to present a common, consistent, and great developer experience on DevNet for your API.</p>
<h2 id='the-basics'>The Basics</h2>
<p>Before we get into the specifics, let&rsquo;s deal with the high-level guidelines or ground rules:</p>

<ul>
<li><em>Keep it Simple</em> - how you use English to communicate to developers is important.  One of the ways you can simplify things is to use person pronouns (e.g., you, we, us) as this approach will naturally simplify your English.</li>
<li><em>Tell Them How Not What</em> - It&rsquo;s possible to simply list all of your API calls, but this does not help the developer.  Instead, group your API end points into what they are used for.  For example, have headings that say &ldquo;Starting a New Discovery Job&rdquo; rather than &ldquo;The Post Discovery Method&rdquo;.</li>
<li><em>Use Examples</em> - this format is designed around code samples; use it!  Try to create an example for each of your API calls.</li>
<li><em>Test the Examples</em> - when you use an example, make sure that it works.</li>
<li><em>Use Graphics</em> - a picture is worth a thousand words.  The right graphic in the right place helps you to keep things simple.</li>
</ul>
<h2 id='language-libraries'>Language Libraries</h2>
<p>REST (or RESTful) APIs are becoming the standard.  Developers like using REST APIs because they are simple and universal.  Because REST APIs use HTTP protocol along with JSON or XML, it is easy to call a REST API from pretty much any programming language.  As a result, there is a natural tendency for the API engineer to think that language libraries (wrappers that make the REST call in the programming language of choice) is not needed. This is a fallacy.</p>

<p>A Programmer can call REST in a language like Python, Java, or C, with four to five lines of code.  When faced with this, the Programmer will typically write their own library of wrappers (code that encapsulates each REST end point) to make programming more module and cleaner.  Thus, if you want your API to be simple to use, you should have the wrappers for popular libraries built.  Next, you should use the language tabs of DevNet Slate to provide the syntax for each of the programming languages that you will be supporting.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">Sample</a>
          </div>
      </div>
    </div>
  </body>
</html>
